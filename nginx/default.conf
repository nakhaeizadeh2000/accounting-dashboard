  events {}

  http {
      server {
          listen 80;
          server_name localhost;

          # File serving configuration
          location ^~ /api/files/ {
              alias /var/www/ACCOUNTING-DASHBOARD/files/;
          
              # Enable efficient file serving
              sendfile on;
              tcp_nopush on;
              tcp_nodelay on;
          
              # Set appropriate MIME types
              include /etc/nginx/mime.types;
              default_type application/octet-stream;
          
              # Allow viewing in the browser by default
              add_header Content-Disposition 'inline';
          
              # Enable caching for static files
              expires 1d;
              add_header Cache-Control "public, max-age=86400";
          
              # Set reasonable timeout values
              proxy_connect_timeout 300s;
              proxy_read_timeout 300s;
              proxy_send_timeout 300s;
          
              # Adjust buffer sizes for better performance
              proxy_buffer_size 16k;
              proxy_buffers 8 16k;
          
              # Optional: Enable gzip compression for text-based files
              gzip on;
              gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
          
              # Security headers
              add_header X-Content-Type-Options nosniff;
              add_header X-Frame-Options SAMEORIGIN;
              add_header X-XSS-Protection "1; mode=block";
          
              # Disable directory listing
              autoindex off;
          
              # Optional: Limit access to specific file types
              # location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
              #     allow all;
              # }
          
              # Optional: Deny access to hidden files
              location ~ /\. {
                  deny all;
              }
          }

          # API configuration
          location /api/ {
              proxy_pass http://api:4000;

              # Rewrite redirect / location headers to match this subdir
              proxy_redirect default;
              proxy_redirect / $scheme://$http_host/api/;

              # Set headers for the proxied request
              proxy_set_header Host $http_host;
              proxy_set_header X-Real-IP $remote_addr;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header X-Forwarded-Proto $scheme;

              # Disable buffering for low-latency responses
              proxy_buffering off;

              # Timeout settings
              proxy_connect_timeout 60s;
              proxy_read_timeout 60s;
              proxy_send_timeout 60s;
          }

          # Client (Next.js) configuration
          location / {
              proxy_pass http://client:3000;

              # WebSocket support
              proxy_http_version 1.1;
              proxy_set_header Upgrade $http_upgrade;
              proxy_set_header Connection "upgrade";
              proxy_set_header Host $host;
          }

          # Specific location for Next.js HMR WebSocket
          location /_next/webpack-hmr {
              proxy_pass http://client:3000;
              proxy_http_version 1.1;
              proxy_set_header Upgrade $http_upgrade;
              proxy_set_header Connection "upgrade";
              proxy_set_header Host $host;
          }
      }
  }